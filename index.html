<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Aplicativo para gerenciar partidas do jogo The Resistance">
    <meta name="theme-color" content="#4a90e2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="The Resistance">
    <title>The Resistance - Configura√ß√£o</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <header>
            <h1>üé≠ The Resistance</h1>
            <p class="subtitle">Configure sua partida</p>
            <button class="btn-install" id="btnInstall" style="display: none;">
                üì± Instalar App
            </button>
            <div style="margin-top: 10px;">
                <a href="como-instalar.html" class="btn-help"
                    style="display: inline-block; color: #4a90e2; text-decoration: none; font-size: 0.9rem; margin-right: 15px;">
                    ‚ùì Como instalar no celular
                </a>
                <a href="diagnostico-pwa.html" class="btn-help"
                    style="display: inline-block; color: #27ae60; text-decoration: none; font-size: 0.9rem; margin-right: 15px;">
                    üîç Diagn√≥stico PWA
                </a>
                <a href="atualizar-app.html" class="btn-help"
                    style="display: inline-block; color: #e74c3c; text-decoration: none; font-size: 0.9rem;">
                    üîÑ Atualizar App
                </a>
            </div>
        </header>

        <main class="setup-screen">
            <!-- History Buttons -->
            <section class="config-section history-section">
                <div class="history-buttons">
                    <button type="button" class="btn-secondary" id="btnLoadHistory">
                        üìã Carregar √öltima Configura√ß√£o
                    </button>
                    <button type="button" class="btn-secondary btn-danger" id="btnClearHistory">
                        üóëÔ∏è Limpar Hist√≥rico
                    </button>
                </div>
                <p class="info-text" id="historyInfo" style="display: none;"></p>
            </section>

            <!-- Step 1: Player Count -->
            <section class="config-section">
                <h2>N√∫mero de Jogadores</h2>
                <div class="player-selector">
                    <button type="button" class="btn-player" data-players="5">5</button>
                    <button type="button" class="btn-player" data-players="6">6</button>
                    <button type="button" class="btn-player" data-players="7">7</button>
                    <button type="button" class="btn-player" data-players="8">8</button>
                    <button type="button" class="btn-player" data-players="9">9</button>
                    <button type="button" class="btn-player" data-players="10">10</button>
                </div>
            </section>

            <!-- Step 2: Player Names -->
            <section class="config-section" id="playerNamesSection" style="display: none;">
                <h2>Nome dos Jogadores</h2>
                <p class="info-text">Digite o nome de cada participante:</p>
                <div id="playerNamesContainer" class="player-names-grid">
                    <!-- Dynamic inputs will be added here -->
                </div>
            </section>

            <!-- Step 3: Special Characters -->
            <section class="config-section">
                <h2>Personagens Especiais</h2>
                <p class="info-text">Selecione os personagens que deseja incluir na partida:</p>

                <div class="characters-grid">
                    <label class="character-option resistance">
                        <input type="checkbox" id="comandante" value="comandante">
                        <div class="character-card">
                            <h3>üëë Comandante</h3>
                            <span class="faction">Resist√™ncia</span>
                            <p>Conhece todos os espi√µes (incluindo Espi√£o Cego)</p>
                        </div>
                    </label>

                    <label class="character-option resistance">
                        <input type="checkbox" id="guardacostas" value="guardacostas">
                        <div class="character-card">
                            <h3>üõ°Ô∏è Guarda-Costas</h3>
                            <span class="faction">Resist√™ncia</span>
                            <p>Conhece o Comandante e protege ele</p>
                        </div>
                    </label>

                    <label class="character-option spy">
                        <input type="checkbox" id="assassino" value="assassino">
                        <div class="character-card">
                            <h3>üó°Ô∏è Assassino</h3>
                            <span class="faction">Espi√£o</span>
                            <p>Deve eliminar o Comandante para vencer</p>
                        </div>
                    </label>

                    <label class="character-option spy">
                        <input type="checkbox" id="espiaocego" value="espiaocego">
                        <div class="character-card">
                            <h3>üëÅÔ∏è Espi√£o Cego</h3>
                            <span class="faction">Espi√£o</span>
                            <p>N√£o conhece/√© conhecido por outros espi√µes, mas Comandante o conhece</p>
                        </div>
                    </label>

                    <label class="character-option spy">
                        <input type="checkbox" id="agenteinvisivel" value="agenteinvisivel">
                        <div class="character-card">
                            <h3>üëª Agente Invis√≠vel</h3>
                            <span class="faction">Espi√£o</span>
                            <p>Invis√≠vel ao Comandante, mas conhece os espi√µes</p>
                        </div>
                    </label>

                    <label class="character-option spy">
                        <input type="checkbox" id="comandantefalso" value="comandantefalso">
                        <div class="character-card">
                            <h3>üëπ Comandante Falso</h3>
                            <span class="faction">Espi√£o</span>
                            <p>Se revela ao Guarda-Costas como Comandante</p>
                        </div>
                    </label>

                    <label class="character-option neutral">
                        <input type="checkbox" id="desertor" value="desertor">
                        <div class="character-card">
                            <h3>üîÑ Desertor (Par)</h3>
                            <span class="faction">Ambas fac√ß√µes</span>
                            <p>1 Resist√™ncia + 1 Espi√£o que podem trocar de lado</p>
                        </div>
                    </label>
                </div>

                <!-- Comandante Falso Options -->
                <div id="comandanteFalsoOptions" class="special-options" style="display: none;">
                    <h3>Op√ß√µes do Comandante Falso:</h3>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="comandanteFalsoType" value="doesntKnow" checked>
                            <span>N√£o conhece os espi√µes (regra oficial)</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="comandanteFalsoType" value="knows">
                            <span>Conhece os espi√µes (variante)</span>
                        </label>
                    </div>
                </div>

                <!-- Desertor Options -->
                <div id="desertorOptions" class="special-options" style="display: none;">
                    <h3>Op√ß√µes do Desertor:</h3>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="desertorType" value="dontKnow" checked>
                            <span>Desertores N√ÉO se conhecem (padr√£o)</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="desertorType" value="knowEachOther">
                            <span>Desertores se conhecem (para muitos jogadores)</span>
                        </label>
                    </div>
                    <p class="info-text">‚ö†Ô∏è Baralho de Troca de Lealdade deve ser usado fisicamente (n√£o implementado no
                        app)</p>
                </div>
            </section>

            <div class="game-info" id="gameInfo">
                <p>Selecione o n√∫mero de jogadores para continuar</p>
            </div>

            <button class="btn-primary btn-start" id="btnStart" disabled>
                Iniciar Jogo
            </button>
        </main>
    </div>

    <script src="js/game.js"></script>
    <script src="js/setup.js"></script>
    <script>
        // PWA Installation
        let deferredPrompt;
        const installButton = document.getElementById('btnInstall');

        // Check if already installed
        function isAppInstalled() {
            // Check if running in standalone mode (already installed)
            if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true) {
                return true;
            }
            return false;
        }

        // Show button on load if PWA is supported but not installed
        window.addEventListener('load', () => {
            // If already installed, hide button
            if (isAppInstalled()) {
                console.log('App j√° est√° instalado');
                installButton.style.display = 'none';
                return;
            }

            // For debugging - show install status
            console.log('PWA Status:', {
                isStandalone: window.matchMedia('(display-mode: standalone)').matches,
                hasServiceWorker: 'serviceWorker' in navigator,
                protocol: window.location.protocol,
                isLocalhost: window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            });

            // Show button if HTTPS or localhost (where PWA works)
            if (window.location.protocol === 'https:' ||
                window.location.hostname === 'localhost' ||
                window.location.hostname === '127.0.0.1') {

                // Check if on mobile
                const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

                if (isMobile) {
                    // On mobile, wait for beforeinstallprompt or show manual instructions
                    console.log('Mobile detectado - aguardando beforeinstallprompt');
                }
            }
        });

        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('beforeinstallprompt disparado!');
            e.preventDefault();
            deferredPrompt = e;
            installButton.style.display = 'inline-block';
        });

        installButton.addEventListener('click', async () => {
            if (!deferredPrompt) {
                console.log('Sem deferredPrompt - mostrando instru√ß√µes manuais');
                // Redirect to instructions page
                window.location.href = 'como-instalar.html';
                return;
            }

            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            console.log(`Escolha do usu√°rio: ${outcome}`);
            deferredPrompt = null;

            if (outcome === 'accepted') {
                installButton.style.display = 'none';
            }
        });

        window.addEventListener('appinstalled', () => {
            console.log('PWA instalado com sucesso!');
            installButton.style.display = 'none';
        });

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./service-worker.js')
                .then(reg => {
                    console.log('Service Worker registrado com sucesso:', reg.scope);
                })
                .catch(err => {
                    console.error('Erro ao registrar Service Worker:', err);
                });
        } else {
            console.log('Service Worker n√£o suportado neste navegador');
        }
    </script>
</body>

</html>